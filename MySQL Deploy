#Create Database
CREATE DATABASE BabyMonitor;

#Switch to new DB
USE BabyMonitor;

CREATE TABLE Sensors ( 
    Id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY 
  , Sensor VARCHAR(30) NOT NULL 
  , Created TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
  );


#Create table to store readings
CREATE TABLE SensorReadings (
    id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
  , Sensor_Id INT(6) UNSIGNED NOT NULL
  , Reading INT(6) NOT NULL
  , Inserted TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP 
  , CONSTRAINT fk_sensor
    FOREIGN KEY (Sensor_Id) REFERENCES Sensors(Id) ON DELETE CASCADE
);

#Create account used to load readings, replace USERNAME and Password
CREATE USER 'USERNAME'@'%' IDENTIFIED BY 'PASSWORD';

#Grant privileges to user setup in setp above
GRANT ALL PRIVILEGES ON SoilSensors.* TO 'USERNAME'@'%';

FLUSH PRIVILEGES;

# Create dim table to hold events
CREATE TABLE DimEvents (
    Id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
  , Event VARCHAR(21844) CHARACTER SET utf8 NOT NULL
  );
    
#Create table to store Event facts E.g. Time and amount of feed
CREATE TABLE FactEvents (
    Id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
,Event_Id INT(6) UNSIGNED NOT NULL
,EventDate DATE 
,EventTime
,EventDetails 
,CONSTRAINT fk_plant
FOREIGN KEY (plant_id) 
   REFERENCES DimPlants(id) ON DELETE CASCADE
);

#Create table to store plot URLs
CREATE TABLE Plots (
 id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
,sensor_id INT(6) UNSIGNED NOT NULL
,sensor VARCHAR(255) NOT NULL
,URL VARCHAR(255) NOT NULL
,CONSTRAINT fk_sensor3
FOREIGN KEY (sensor_id) 
   REFERENCES Sensors(id) ON DELETE CASCADE
);

#Create table to store water pump pin assignments
CREATE TABLE SoilSensors.Pins (
 id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
,sensor_id INT(6) UNSIGNED NOT NULL
,pin INT(6) UNSIGNED NOT NULL
,CONSTRAINT fk_sensor4
FOREIGN KEY (sensor_id) 
   REFERENCES Sensors(id) ON DELETE CASCADE
);

#Create table to store possible gpio pins for assignment
CREATE TABLE SoilSensors.DimPins (
 id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
,pin INT(6) UNSIGNED NOT NULL
);
