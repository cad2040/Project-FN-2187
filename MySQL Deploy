#Create Database
CREATE DATABASE BabyMonitor;

#Switch to new DB
USE BabyMonitor;

#Create account used to load readings, replace USERNAME and Password
CREATE USER 'USERNAME'@'%' IDENTIFIED BY 'PASSWORD';

#Grant privileges to user setup in setp above
GRANT ALL PRIVILEGES ON BabyMonitor.* TO 'USERNAME'@'%';

FLUSH PRIVILEGES;

CREATE TABLE Sensors ( 
    Id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY 
  , Sensor VARCHAR(256) NOT NULL 
  , Created TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
  );


#Create table to store readings
CREATE TABLE SensorReadings (
    id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
  , Sensor_Id INT(6) UNSIGNED NOT NULL
  , Reading FLOAT(8,5) NOT NULL
  , Inserted TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP 
  , CONSTRAINT fk_sensor
      FOREIGN KEY (Sensor_Id) REFERENCES Sensors(Id) ON DELETE CASCADE
);

# Create dim table to hold events
CREATE TABLE DimEvents (
    Id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
  , Event VARCHAR(21844) CHARACTER SET utf8 NOT NULL
  );
    
#Create table to store Event facts E.g. Time and amount of feed
CREATE TABLE FactEvents (
    Id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
  , Event_Id INT(6) UNSIGNED NOT NULL
  , EventDate DATE 
  , EventTime
  , VARCHAR(21844) CHARACTER SET utf8 NOT NULL
  , CONSTRAINT fk_event
      FOREIGN KEY (Event_Id) REFERENCES DimEvents(Id) ON DELETE CASCADE
  );

#Create table to store plot URLs
CREATE TABLE Plots (
    Id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY
  , Sensor_Id INT(6) UNSIGNED NOT NULL
  , Sensor VARCHAR(256) NOT NULL
  , URL VARCHAR(21844) CHARACTER SET utf8 NOT NULL
  , CONSTRAINT fk_sensor3
      FOREIGN KEY (Sensor_Id) REFERENCES Sensors(Id) ON DELETE CASCADE
  );

